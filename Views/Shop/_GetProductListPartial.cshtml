@model X.PagedList.IPagedList<ProductListViewModel>
@using X.PagedList.Mvc.Core

<div class="row shop_wrapper">
    @foreach (var item in Model)
    {
        <div class="col-lg-4 col-md-4 col-12 ">
            <article class="single_product">
                <figure>
                    <div class="product_thumb">
                        <a class="primary_img" asp-action="Details" asp-controller="Shop" asp-route-id="@item.Id">
                            <img src="@(string.IsNullOrEmpty(item.AnhDaiDienUrl) ? "/images/avatars/default.jpg" : item.AnhDaiDienUrl)" alt="Anh dai dien" />
                        </a>
                        <a class="secondary_img" asp-action="Details" asp-controller="Shop" asp-route-id="@item.Id">
                            <img src="@(string.IsNullOrEmpty(item.AnhPhuUrl) ? "/images/avatars/default.jpg" : item.AnhPhuUrl)" alt="Anh phu" />
                        </a>

                        @* Badge phần trăm giảm trên góc ảnh *@
                        @if (item.HasPromotion && item.BestDiscountPercent.HasValue && item.BestDiscountPercent.Value > 0)
                        {
                            <span class="discount-badge">-@item.BestDiscountPercent.Value.ToString("0")%</span>
                        }
                    </div>

                    @* GRID VIEW *@
                    <div class="product_content grid_content">
                        <div class="product_content-header">
                            <h4 class="product_name">
                                <a asp-action="Details" asp-controller="Shop" asp-route-id="@item.Id">
                                    @item.TenSanPham
                                </a>
                            </h4>
                            <div class="wishlist-btn">
                                <a href="#"><i class="zmdi zmdi-favorite-outline"></i></a>
                            </div>
                        </div>
                        <div class="product_price_rating">
                            <div class="price_box">
                                @if (item.HasPromotion && !string.IsNullOrEmpty(item.OriginalPriceString))
                                {
                                    <span class="old_price">@item.OriginalPriceString</span>
                                    <span class="current_price">@item.PriceString</span>
                                }
                                else
                                {
                                    <span class="current_price">@item.PriceString</span>
                                }
                            </div>
                            <div class="product_rating">
                                <ul>
                                    <li><a href="#"><i class="fa fa-star" aria-hidden="true"></i></a></li>
                                    <li><a href="#"><i class="fa fa-star" aria-hidden="true"></i></a></li>
                                    <li><a href="#"><i class="fa fa-star" aria-hidden="true"></i></a></li>
                                    <li><a href="#"><i class="fa fa-star" aria-hidden="true"></i></a></li>
                                    <li><a href="#"><i class="fa fa-star" aria-hidden="true"></i></a></li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    @* LIST VIEW *@
                    <div class="product_content list_content">
                        <h4 class="product_name">
                            <a asp-action="Details" asp-controller="Shop" asp-route-id="@item.Id">
                                @item.TenSanPham
                            </a>
                        </h4>

                        <div class="product_price_rating">
                            <div class="price_box">
                                @if (item.HasPromotion && !string.IsNullOrEmpty(item.OriginalPriceString))
                                {
                                    <span class="old_price">@item.OriginalPriceString</span>
                                    <span class="current_price">@item.PriceString</span>
                                }
                                else
                                {
                                    <span class="current_price">@item.PriceString</span>
                                }
                            </div>
                            <div class="product_rating">
                                <ul>
                                    <li><a href="#"><i class="fa fa-star" aria-hidden="true"></i></a></li>
                                    <li><a href="#"><i class="fa fa-star" aria-hidden="true"></i></a></li>
                                    <li><a href="#"><i class="fa fa-star" aria-hidden="true"></i></a></li>
                                    <li><a href="#"><i class="fa fa-star" aria-hidden="true"></i></a></li>
                                    <li><a href="#"><i class="fa fa-star" aria-hidden="true"></i></a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </figure>
            </article>
        </div>
    }
</div>

<div class="shop_toolbar_wrapper">
    <div class="pagination">
        @Html.PagedListPager(
        Model,
        page => Url.Action("Index",
                new
                {
                    page = page,
                    idDanhMuc = ViewBag.CurrentDanhMucId,
                    listfilter = ViewBag.CurrentListFilter
                                                           // nếu có thêm filter khác (search, hasPromotion, isBestSeller, ...) thì nhớ truyền tiếp
                }
                )
                )
    </div>
    <div class="page_amount">
        @if (Model.TotalItemCount > 0)
        {
            <p>
                Hiển thị @Model.FirstItemOnPage–@Model.LastItemOnPage of @Model.TotalItemCount sản phẩm
            </p>
        }
        else
        {
            <p>Không có sản phẩm nào</p>
        }
    </div>
</div>

<style>
    .old_price {
        text-decoration: line-through;
        color: #999;
        margin-right: 6px;
        font-size: 0.9em;
    }

    .sale-badge {
        background: #e3342f;
        color: #fff;
        padding: 2px 6px;
        border-radius: 4px;
        font-size: 0.75rem;
        margin-left: 6px;
    }

    /* Badge trên ảnh */
    .product_thumb {
        position: relative;
    }

    .discount-badge {
        position: absolute;
        top: 8px;
        left: 8px;
        background: #e3342f;
        color: #fff;
        padding: 4px 8px;
        font-size: 0.75rem;
        font-weight: 600;
        border-radius: 4px;
        z-index: 5;
    }
</style>
