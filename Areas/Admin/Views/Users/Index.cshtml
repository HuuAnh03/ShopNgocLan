@* BƯỚC 1: THAY ĐỔI MODEL VÀ THÊM USING *@

@model X.PagedList.IPagedList<User>

@using X.PagedList.Mvc.Core;

@{
    Layout = "~/Views/Shared/AdminLayout.cshtml";
}


<div class="page-content">



    <div class="container-xxl">

        <div class="pagetitle">
            <h3>Danh sách  người dùng</h3>
            <nav>
                <ol class="breadcrumb">
                    <li class="breadcrumb-item">
                        <a asp-area="Admin" asp-controller="Dashboard" asp-action="Index">Trang tổng quan</a>
                    </li>
                    <li class="breadcrumb-item active">Danh sách người dùng</li>
                </ol>
            </nav>
        </div>
        <div class="row">

            <div class="col-xl-12">

                <div class="card">
                    <div>

                        <a asp-action="Create" asp-controller="Users" class="btn btn-success btn-sm">

                            <i class='bx bx-plus'></i> Thêm User Mới

                        </a>

                    </div>

                    <div>

                        <div class="table-responsive">

                            <table class="table align-middle mb-0 table-hover table-centered">

                                <thead class="bg-light-subtle">

                                    <tr>

                                        <th style="width: 20px;">

                                            <div class="form-check">

                                                <input type="checkbox" class="form-check-input" id="customCheck1">

                                                <label class="form-check-label" for="customCheck1"></label>

                                            </div>

                                        </th>

                                        <th>Tên Khách Hàng</th>

                                        <th>Email</th>

                                        <th>Số điện thoại</th>

                                        <th>Ngày sinh</th>

                                        <th>Giới tính</th>

                                        <th>Vai Trò</th>

                                        <th>Ngày Tham Gia</th>

                                        <th class="text-center">Hành Động</th>

                                    </tr>

                                </thead>

                                <tbody>

                                    @* Vòng lặp này vẫn đúng, vì Model (IPagedList) cũng là 1 danh sách *@

                                    @foreach (var user in Model)

                                    {

                                        <tr>

                                            <td>

                                                <div class="form-check">

                                                    <input type="checkbox" class="form-check-input" id="user-@user.Id">

                                                    <label class="form-check-label" for="user-@user.Id">&nbsp;</label>

                                                </div>

                                            </td>

                                            <td>

                                                <img src="@(string.IsNullOrEmpty(user.AvatarUrl) ? "/images/avatars/default.jpg" : user.AvatarUrl)" class="avatar-sm rounded-circle me-2" alt="...">

                                                @(user.Ho) @(user.Ten)

                                            </td>

                                            <td>

                                                <a href="mailto:@user.Email" class="text-body">@user.Email</a>

                                            </td>

                                            <td>

                                                @if (!string.IsNullOrEmpty(user.SoDienThoai))

                                                {

                                                    <small class="text-muted">@user.SoDienThoai</small>

                                                }

                                            </td>

                                            <td>@(user.NgaySinh?.ToString("dd/MM/yyyy") ?? "Chưa nhập")</td>

                                            <td>@(user.GioiTinh?.ToString() ?? "Chưa nhập")</td>

                                            <td>

                                                @if (user.RoleId == 1)

                                                {

                                                    <span class="badge bg-danger-subtle text-danger py-1 px-2">Admin</span>

                                                }

                                                else if (user.RoleId == 2)

                                                {

                                                    <span class="badge bg-primary-subtle text-primary py-1 px-2">Nhân viên</span>

                                                }

                                                else

                                                {

                                                    <span class="badge bg-success-subtle text-success py-1 px-2">Khách Hàng</span>

                                                }

                                            </td>

                                            <td>

                                                @user.NgayTao?.ToString("dd/MM/yyyy")

                                            </td>

                                            <td class="text-center">

                                                <div class="d-flex gap-2 justify-content-center">

                                                    <a asp-action="Detail" asp-route-id="@user.Id" class="btn btn-light btn-sm"><iconify-icon icon="solar:eye-broken" class="align-middle fs-18"></iconify-icon></a>

                                                    <a asp-action="Edit" asp-route-id="@user.Id" class="btn btn-soft-primary btn-sm"><iconify-icon icon="solar:pen-2-broken" class="align-middle fs-18"></iconify-icon></a>

                                                    <a asp-action="Delete" asp-route-id="@user.Id" class="btn btn-soft-danger btn-sm"><iconify-icon icon="solar:trash-bin-minimalistic-2-broken" class="align-middle fs-18"></iconify-icon></a>

                                                </div>

                                            </td>

                                        </tr>

                                    }

                                </tbody>

                            </table>

                        </div>

                    </div>



                    @* BƯỚC 3: CÁCH 3 (SIÊU THỦ CÔNG) - TỰ XÂY DỰNG LOGIC PHÂN TRANG *@

                    <div class="card-footer border-top">

                        <nav aria-label="Page navigation example">



                            @* Chỉ hiển thị thanh phân trang nếu có nhiều hơn 1 trang *@

                            @if (Model.PageCount > 1)

                            {

                                <ul class="pagination justify-content-end mb-0">



                                    @* B1: Xử lý nút "Previous" (Lùi) *@

                                    @if (Model.HasPreviousPage)

                                    {

                                        <li class="page-item">

                                            <a class="page-link" href="@Url.Action("Index", new { page = Model.PageNumber - 1 })">Previous</a>

                                        </li>

                                    }

                                    else

                                    {

                                        <li class="page-item disabled">

                                            <a class="page-link" href="#" tabindex="-1">Previous</a>

                                        </li>

                                    }



                                    @* B2: Xử lý các nút số trang *@

                                    @for (int i = 1; i <= Model.PageCount; i++)

                                    {

                                        if (i == Model.PageNumber)

                                        {

                                            // Trang hiện tại

                                            <li class="page-item active" aria-current="page">

                                                <a class="page-link" href="#">@i</a>

                                            </li>

                                        }

                                        else

                                        {

                                            // Các trang khác

                                            <li class="page-item">

                                                <a class="page-link" href="@Url.Action("Index", new { page = i })">@i</a>

                                            </li>

                                        }

                                    }



                                    @* B3: Xử lý nút "Next" (Tiếp) *@

                                    @if (Model.HasNextPage)

                                    {

                                        <li class="page-item">

                                            <a class="page-link" href="@Url.Action("Index", new { page = Model.PageNumber + 1 })">Next</a>

                                        </li>

                                    }

                                    else

                                    {

                                        <li class="page-item disabled">

                                            <a class="page-link" href="#">Next</a>

                                        </li>

                                    }

                                </ul>

                            }



                        </nav>

                    </div>

                </div>

            </div>



        </div>

    </div>

</div>